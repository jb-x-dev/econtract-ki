<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partner - eContract KI</title>
    
    <!-- Unified Menu CSS -->
    <link rel="stylesheet" href="css/econtract-modern.css">
    
    
    <!-- Responsive CSS -->
    
    
    <style>
        .content-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .content-header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }
        
        .content-header p {
            margin: 0;
            opacity: 0.9;
        }
        
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .toolbar button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .toolbar button:hover {
            background: #2563eb;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
        }
        
        .search-box input {
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            min-width: 300px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #64748b;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #1e293b;
        }
        
        .partners-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .partners-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .partners-table th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #1e40af;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .partners-table td {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .partners-table tr:hover {
            background: #f8fafc;
        }
        
        .partner-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .type-customer {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .type-supplier {
            background: #d1fae5;
            color: #065f46;
        }
        
        .type-both {
            background: #fef3c7;
            color: #92400e;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-buttons button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-view {
            background: #3b82f6;
            color: white;
        }
        
        .btn-view:hover {
            background: #2563eb;
        }
        
        .btn-edit {
            background: #10b981;
            color: white;
        }
        
        .btn-edit:hover {
            background: #059669;
        }
        
        .btn-delete {
            background: #ef4444;
            color: white;
        }
        
        .btn-delete:hover {
            background: #dc2626;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #475569;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .form-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }
        
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
    </style>
</head>
<body>
    <!-- Unified Sidebar -->
    <aside id="unified-sidebar"></aside>

    <!-- Main Content -->
    <div id="main-content">
        <!-- Content Header -->
        <div class="content-header">
            <h1>üè¢ Partner</h1>
            <p>Verwaltung von Kunden und Lieferanten</p>
        </div>

        <!-- Page Content -->
        <div class="container">
            <!-- Toolbar -->
            <div class="toolbar">
                <button onclick="showCreateModal()">
                    ‚ûï Neuer Partner
                </button>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Partner durchsuchen..." 
                           onkeyup="handleSearch(event)">
                    <button onclick="searchPartners()">üîç Suchen</button>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <h3>Gesamt</h3>
                    <p class="stat-number" id="totalPartners">-</p>
                </div>
                <div class="stat-card">
                    <h3>Kunden</h3>
                    <p class="stat-number" id="customerCount">-</p>
                </div>
                <div class="stat-card">
                    <h3>Lieferanten</h3>
                    <p class="stat-number" id="supplierCount">-</p>
                </div>
                <div class="stat-card">
                    <h3>Aktive Vertr√§ge</h3>
                    <p class="stat-number" id="activeContracts">-</p>
                </div>
            </div>

            <!-- Partners Table -->
            <div class="partners-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Typ</th>
                            <th>Kontakt</th>
                            <th>Email</th>
                            <th>Telefon</th>
                            <th>Aktionen</th>
                        </tr>
                    </thead>
                    <tbody id="partnersTableBody">
                        <tr>
                            <td colspan="7" class="loading">
                                Lade Partner-Daten...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create/Edit Partner Modal -->
    <div id="partnerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Neuer Partner</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="partnerForm" onsubmit="savePartner(event)">
                <input type="hidden" id="partnerId">
                
                <div class="form-group">
                    <label for="partnerName">Name *</label>
                    <input type="text" id="partnerName" required>
                </div>
                
                <div class="form-group">
                    <label for="partnerType">Typ *</label>
                    <select id="partnerType" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="CUSTOMER">Kunde</option>
                        <option value="SUPPLIER">Lieferant</option>
                        <option value="BOTH">Kunde & Lieferant</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="contactPerson">Kontaktperson</label>
                    <input type="text" id="contactPerson">
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email">
                </div>
                
                <div class="form-group">
                    <label for="phone">Telefon</label>
                    <input type="tel" id="phone">
                </div>
                
                <div class="form-group">
                    <label for="address">Adresse</label>
                    <textarea id="address"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notizen</label>
                    <textarea id="notes"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Unified Menu JS -->
    <script src="js/unified-menu.js"></script>
    
    <!-- Partners JS -->
    <script>
        const API_BASE = '/econtract/api/partners';
        
        // Load partners on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadPartners();
            loadStatistics();
        });
        
        // Load partners from API
        async function loadPartners() {
            try {
                const response = await fetch(API_BASE);
                if (!response.ok) throw new Error('Failed to load partners');
                
                const partners = await response.json();
                displayPartners(partners);
            } catch (error) {
                console.error('Error loading partners:', error);
                document.getElementById('partnersTableBody').innerHTML = `
                    <tr>
                        <td colspan="7" class="no-data">
                            Fehler beim Laden der Partner-Daten. Bitte versuchen Sie es sp√§ter erneut.
                        </td>
                    </tr>
                `;
            }
        }
        
        // Display partners in table
        function displayPartners(partners) {
            const tbody = document.getElementById('partnersTableBody');
            
            if (!partners || partners.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-data">
                            Keine Partner gefunden. Erstellen Sie einen neuen Partner mit dem Button oben.
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = partners.map(partner => `
                <tr>
                    <td>${partner.id}</td>
                    <td><strong>${partner.name}</strong></td>
                    <td><span class="partner-type type-${partner.type.toLowerCase()}">${getTypeLabel(partner.type)}</span></td>
                    <td>${partner.contactPerson || '-'}</td>
                    <td>${partner.email || '-'}</td>
                    <td>${partner.phone || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-view" onclick="viewPartner(${partner.id})" title="Anzeigen">üëÅÔ∏è</button>
                            <button class="btn-edit" onclick="editPartner(${partner.id})" title="Bearbeiten">‚úèÔ∏è</button>
                            <button class="btn-delete" onclick="deletePartner(${partner.id})" title="L√∂schen">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // Get type label
        function getTypeLabel(type) {
            const labels = {
                'CUSTOMER': 'Kunde',
                'SUPPLIER': 'Lieferant',
                'BOTH': 'Kunde & Lieferant'
            };
            return labels[type] || type;
        }
        
        // Load statistics
        async function loadStatistics() {
            try {
                const response = await fetch(API_BASE);
                if (!response.ok) throw new Error('Failed to load statistics');
                
                const partners = await response.json();
                
                const customerCount = partners.filter(p => p.type === 'CUSTOMER' || p.type === 'BOTH').length;
                const supplierCount = partners.filter(p => p.type === 'SUPPLIER' || p.type === 'BOTH').length;
                
                document.getElementById('totalPartners').textContent = partners.length;
                document.getElementById('customerCount').textContent = customerCount;
                document.getElementById('supplierCount').textContent = supplierCount;
                document.getElementById('activeContracts').textContent = '-'; // Would come from contracts API
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }
        
        // Show create modal
        function showCreateModal() {
            document.getElementById('modalTitle').textContent = 'Neuer Partner';
            document.getElementById('partnerForm').reset();
            document.getElementById('partnerId').value = '';
            document.getElementById('partnerModal').classList.add('active');
        }
        
        // View partner
        async function viewPartner(id) {
            try {
                const response = await fetch(`${API_BASE}/${id}`);
                if (!response.ok) throw new Error('Failed to load partner');
                
                const partner = await response.json();
                alert(`Partner Details:\n\nName: ${partner.name}\nTyp: ${getTypeLabel(partner.type)}\nKontakt: ${partner.contactPerson || '-'}\nEmail: ${partner.email || '-'}\nTelefon: ${partner.phone || '-'}\nAdresse: ${partner.address || '-'}\nNotizen: ${partner.notes || '-'}`);
            } catch (error) {
                console.error('Error loading partner:', error);
                alert('Fehler beim Laden der Partner-Details.');
            }
        }
        
        // Edit partner
        async function editPartner(id) {
            try {
                const response = await fetch(`${API_BASE}/${id}`);
                if (!response.ok) throw new Error('Failed to load partner');
                
                const partner = await response.json();
                
                document.getElementById('modalTitle').textContent = 'Partner bearbeiten';
                document.getElementById('partnerId').value = partner.id;
                document.getElementById('partnerName').value = partner.name;
                document.getElementById('partnerType').value = partner.type;
                document.getElementById('contactPerson').value = partner.contactPerson || '';
                document.getElementById('email').value = partner.email || '';
                document.getElementById('phone').value = partner.phone || '';
                document.getElementById('address').value = partner.address || '';
                document.getElementById('notes').value = partner.notes || '';
                
                document.getElementById('partnerModal').classList.add('active');
            } catch (error) {
                console.error('Error loading partner:', error);
                alert('Fehler beim Laden der Partner-Daten.');
            }
        }
        
        // Delete partner
        async function deletePartner(id) {
            if (!confirm('M√∂chten Sie diesen Partner wirklich l√∂schen?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error('Failed to delete partner');
                
                alert('Partner erfolgreich gel√∂scht!');
                loadPartners();
                loadStatistics();
            } catch (error) {
                console.error('Error deleting partner:', error);
                alert('Fehler beim L√∂schen des Partners.');
            }
        }
        
        // Save partner
        async function savePartner(event) {
            event.preventDefault();
            
            const id = document.getElementById('partnerId').value;
            const partner = {
                name: document.getElementById('partnerName').value,
                type: document.getElementById('partnerType').value,
                contactPerson: document.getElementById('contactPerson').value || null,
                email: document.getElementById('email').value || null,
                phone: document.getElementById('phone').value || null,
                address: document.getElementById('address').value || null,
                notes: document.getElementById('notes').value || null
            };
            
            try {
                const url = id ? `${API_BASE}/${id}` : API_BASE;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(partner)
                });
                
                if (!response.ok) throw new Error('Failed to save partner');
                
                alert('Partner erfolgreich gespeichert!');
                closeModal();
                loadPartners();
                loadStatistics();
            } catch (error) {
                console.error('Error saving partner:', error);
                alert('Fehler beim Speichern des Partners.');
            }
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('partnerModal').classList.remove('active');
        }
        
        // Search partners
        function searchPartners() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#partnersTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // Handle search on Enter key
        function handleSearch(event) {
            if (event.key === 'Enter') {
                searchPartners();
            }
        }
        
        // Close modal on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
        // Close modal on outside click
        document.getElementById('partnerModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
